language: rust

services:
  - docker

git:
  depth: 1

os:
  - linux
  - osx
  - windows

rust:
  - stable
  - beta
  - nightly

matrix:
  fast_finish: true
  include:
    - if: tag IS present
      os: linux
      rust: stable
      env: ARCH=i386
    - name: "Clippy Linux"
      os: linux
      env: CLIPPY=true
      rust: stable
    - name: "Clippy OSX"
      os: osx
      env: CLIPPY=true
      rust: stable
    - name: "Clippy Windows"
      os: windows
      env: CLIPPY=true
      rust: stable
  allow_failures:
    - rust: nightly

install: ci/install.sh
script: ci/script.sh
before_deploy: ci/before_deploy.sh

deploy:
  provider: releases
  api_key:
    secure: TCXxq3NxQqsGRM032TjNAGey4TP6J2TnhOuF6UN4Z55CRbHW3vu97zus91mH6AeM6BoQIJUsLB/CMxn6tXPh9PyrLeyERDlK7+6x5X635k1i55ODCvuZUD5kZCKpNgqPZXQB+6hd7qi80g1fvwd/O6zcwg3WHk/pt7WL0g+MzL43GMI/bLGEpOPVVb7UaPdXG1n2npKNuJ0FRHiALYuWxLwP1pjQ1Di66gK6+xMi8mnEin79i9Q95b264bBhxzC9lSa7JGFI6HO5JjXRbLNXBnoSIWVYC/TyVY5YjGGTWqRjYWh5AXM+1fPvI84UrnkdPBeKHM2c3vQK+WaFgOAtHn+AQpceegfQInAUiAH3eqceYxVNo8F7Tbx8vM/ctBpA/Htsw2KriBPS1PWjzh1VrWiHfkpx5bnozAW6Z8erq3wrnR7yj4/k3IAjxVsavCOzToV3S2JnbpfGs4XWpeX/rQEIQH9Z9PEbxj/Zv3IouH3qCilqsOdHwd4hPznd67eemL8W0bvRb6KyKD4GZZKmSpq1ZtzcvopzG4mos9g2mhe+ENZW3o1twyoQ/BBJhDBlrnkc0iT+sShNpQgSkyUuRGmztJeEFEDJS2eWdW0MlrELZQj7z46QxWDw6p7CtcnChEgfUo7nBtrLmusMKDk2FsYmSZDkE6IWV57WHEHcvK4=
  skip_cleanup: true
  file_glob: true
  file: "./target/deploy/*"
  on:
    tags: true
    rust: stable
    condition: $CLIPPY != true
    repo: eberkund/alacritty
    branch: master
